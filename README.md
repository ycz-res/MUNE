# MUNE - CMAPå›¾é¢„æµ‹MUå’Œé˜ˆå€¼æ·±åº¦å­¦ä¹ æ¡†æ¶

åŸºäºæ·±åº¦å­¦ä¹ çš„CMAPï¼ˆCompound Mapï¼‰å›¾åƒåˆ†ææ¡†æ¶ï¼Œç”¨äºé¢„æµ‹MUï¼ˆMotor Unitï¼‰æ•°é‡å’Œå¯¹åº”çš„ä¸å®šé•¿MUé˜ˆå€¼ã€‚

## ä»»åŠ¡æè¿°

æœ¬é¡¹ç›®çš„ä¸»è¦ä»»åŠ¡æ˜¯ï¼š
- **è¾“å…¥**: CMAPå›¾åƒæ•°æ®
- **è¾“å‡º1**: é¢„æµ‹MUæ•°é‡
- **è¾“å‡º2**: é¢„æµ‹ä¸å®šé•¿MUå¯¹åº”çš„é˜ˆå€¼

è¿™æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡å­¦ä¹ é—®é¢˜ï¼Œéœ€è¦åŒæ—¶é¢„æµ‹è¿ç»­å€¼ï¼ˆMUæ•°é‡ï¼‰å’Œåˆ†ç±»/å›å½’å€¼ï¼ˆé˜ˆå€¼ï¼‰ã€‚

## é¡¹ç›®ç»“æ„

```
MUNE/
â”œâ”€â”€ model.py              # æ·±åº¦å­¦ä¹ æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ BaseModel         # åŸºç¡€æ¨¡å‹ç±»
â”‚   â”œâ”€â”€ SimpleMLP         # å¤šå±‚æ„ŸçŸ¥æœº
â”‚   â””â”€â”€ SimpleCNN         # å·ç§¯ç¥ç»ç½‘ç»œ
â”œâ”€â”€ dataset.py            # æ•°æ®é›†å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ BaseDataset       # åŸºç¡€æ•°æ®é›†ç±»
â”‚   â”œâ”€â”€ SimDataset        # ä»¿çœŸæ•°æ®é›†
â”‚   â””â”€â”€ HPDataset         # HPæ•°æ®é›†ï¼ˆCMAPå›¾åƒï¼‰
â”œâ”€â”€ train.py              # è®­ç»ƒé€»è¾‘
â”‚   â”œâ”€â”€ Trainer           # è®­ç»ƒå™¨ç±»
â”‚   â”œâ”€â”€ æ—©åœæœºåˆ¶          # Early Stopping
â”‚   â””â”€â”€ æ£€æŸ¥ç‚¹ç®¡ç†        # Checkpoint Management
â”œâ”€â”€ train_hp.py           # HPæ•°æ®é›†ä¸“ç”¨è®­ç»ƒè„šæœ¬
â”œâ”€â”€ hp_dataset_manager.py # HPæ•°æ®é›†ç®¡ç†å™¨
â”œâ”€â”€ loss.py               # æŸå¤±å‡½æ•°å®šä¹‰
â”‚   â”œâ”€â”€ CrossEntropyLoss  # äº¤å‰ç†µæŸå¤±
â”‚   â”œâ”€â”€ FocalLoss         # Focal Loss
â”‚   â””â”€â”€ CombinedLoss      # ç»„åˆæŸå¤±ï¼ˆMUæ•°é‡+é˜ˆå€¼ï¼‰
â”œâ”€â”€ metrics.py            # è¯„ä¼°æŒ‡æ ‡
â”‚   â”œâ”€â”€ Accuracy          # å‡†ç¡®ç‡
â”‚   â”œâ”€â”€ Precision/Recall  # ç²¾ç¡®ç‡/å¬å›ç‡
â”‚   â”œâ”€â”€ F1Score           # F1åˆ†æ•°
â”‚   â””â”€â”€ AUROC             # AUC-ROC
â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Config            # é…ç½®ç±»
â”‚   â””â”€â”€ ç‚¹å·è¯­æ³•è®¿é—®      # config['model.name']
â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”œâ”€â”€ logger.py             # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ main.py               # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ test_dataset.py       # æ•°æ®é›†æµ‹è¯•è„šæœ¬
â”œâ”€â”€ config.yaml           # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–åŒ…
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•ï¼ˆå·²åŠ å…¥.gitignoreï¼‰
â”‚   â”œâ”€â”€ train/            # è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ val/              # éªŒè¯æ•°æ®
â”‚   â””â”€â”€ test/             # æµ‹è¯•æ•°æ®
â”œâ”€â”€ logs/                 # è®­ç»ƒæ—¥å¿—ï¼ˆå·²åŠ å…¥.gitignoreï¼‰
â”‚   â”œâ”€â”€ tensorboard/      # TensorBoardæ—¥å¿—
â”‚   â””â”€â”€ training.log      # è®­ç»ƒæ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ checkpoints/          # æ¨¡å‹æ£€æŸ¥ç‚¹ï¼ˆå·²åŠ å…¥.gitignoreï¼‰
â”‚   â”œâ”€â”€ best_model.pth    # æœ€ä½³æ¨¡å‹
â”‚   â””â”€â”€ latest_model.pth  # æœ€æ–°æ¨¡å‹
â””â”€â”€ .gitignore            # Gitå¿½ç•¥æ–‡ä»¶
```

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ å¤šä»»åŠ¡å­¦ä¹ 
- **MUæ•°é‡é¢„æµ‹**: å›å½’ä»»åŠ¡ï¼Œé¢„æµ‹CMAPå›¾ä¸­çš„è¿åŠ¨å•å…ƒæ•°é‡
- **é˜ˆå€¼é¢„æµ‹**: åˆ†ç±»/å›å½’ä»»åŠ¡ï¼Œé¢„æµ‹ä¸å®šé•¿MUå¯¹åº”çš„é˜ˆå€¼

### ğŸ§  æ¨¡å‹æ¶æ„
- **SimpleMLP**: é€‚ç”¨äºç‰¹å¾å‘é‡çš„å¤šå±‚æ„ŸçŸ¥æœº
- **SimpleCNN**: é€‚ç”¨äºCMAPå›¾åƒæ•°æ®çš„å·ç§¯ç¥ç»ç½‘ç»œ
- **å¤šè¾“å‡ºå¤´**: æ”¯æŒåŒæ—¶é¢„æµ‹MUæ•°é‡å’Œé˜ˆå€¼

### ğŸ“Š æ•°æ®å¤„ç†
- **CMAPå›¾åƒé¢„å¤„ç†**: å›¾åƒæ ‡å‡†åŒ–ã€å¢å¼ºç­‰
- **MATLABæ–‡ä»¶æ”¯æŒ**: è¯»å–.matæ ¼å¼çš„CMAPæ•°æ®
- **æ•°æ®å¢å¼º**: æ—‹è½¬ã€ç¿»è½¬ã€å™ªå£°æ·»åŠ ç­‰

### ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡
- **å›å½’æŒ‡æ ‡**: MAEã€MSEã€RÂ²ï¼ˆç”¨äºMUæ•°é‡é¢„æµ‹ï¼‰
- **åˆ†ç±»æŒ‡æ ‡**: å‡†ç¡®ç‡ã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°ï¼ˆç”¨äºé˜ˆå€¼é¢„æµ‹ï¼‰
- **ç»¼åˆæŒ‡æ ‡**: å¤šä»»åŠ¡å­¦ä¹ çš„åŠ æƒæŸå¤±

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd MUNE

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®å‡†å¤‡

```bash
# å°†CMAPæ•°æ®æ–‡ä»¶æ”¾åœ¨dataç›®å½•ä¸‹
mkdir -p data/train data/val data/test

# æ•°æ®æ ¼å¼ï¼š.matæ–‡ä»¶ï¼ŒåŒ…å«CMAPå›¾åƒå’Œæ ‡ç­¾
# æ ‡ç­¾æ ¼å¼ï¼š[MUæ•°é‡, é˜ˆå€¼]
```

### 3. è®­ç»ƒæ¨¡å‹

```bash
# ä½¿ç”¨HPæ•°æ®é›†è®­ç»ƒ
python train_hp.py --data_root ./data --model simple_cnn --epochs 100

# ä½¿ç”¨é…ç½®æ–‡ä»¶è®­ç»ƒ
python train_hp.py --config config.yaml

# æ¢å¤è®­ç»ƒ
python train_hp.py --resume ./checkpoints/latest_model.pth
```

### 4. æ¨¡å‹è¯„ä¼°

```bash
# ä»…è¯„ä¼°æ¨¡å¼
python train_hp.py --data_root ./data --eval_only --resume ./checkpoints/best_model.pth

# åœ¨çœŸå®æ•°æ®ä¸Šæµ‹è¯•
python train_hp.py --data_root ./data --eval_only --resume ./checkpoints/best_model.pth --test_real_data
```

## é…ç½®è¯´æ˜

### æ¨¡å‹é…ç½®

```yaml
model:
  name: simple_cnn  # æ¨¡å‹åç§°
  config:
    input_channels: 1      # è¾“å…¥é€šé“æ•°
    num_classes_mu: 1     # MUæ•°é‡è¾“å‡ºç»´åº¦
    num_classes_threshold: 10  # é˜ˆå€¼åˆ†ç±»æ•°é‡
    dropout_rate: 0.5
```

### æ•°æ®é›†é…ç½®

```yaml
dataset:
  name: hp               # æ•°æ®é›†åç§°
  data_path: ./data      # æ•°æ®è·¯å¾„
  batch_size: 32         # æ‰¹æ¬¡å¤§å°
  num_workers: 4         # æ•°æ®åŠ è½½çº¿ç¨‹æ•°
  image_size: [224, 224] # å›¾åƒå°ºå¯¸
```

### è®­ç»ƒé…ç½®

```yaml
training:
  num_epochs: 100
  device: auto
  save_dir: ./checkpoints
  early_stopping_patience: 10
  learning_rate: 0.001
  weight_decay: 1e-4
```

## æ”¯æŒçš„æ¨¡å‹

- `simple_mlp`: å¤šå±‚æ„ŸçŸ¥æœºï¼ˆé€‚ç”¨äºç‰¹å¾å‘é‡ï¼‰
- `simple_cnn`: å·ç§¯ç¥ç»ç½‘ç»œï¼ˆé€‚ç”¨äºCMAPå›¾åƒï¼‰

## æ”¯æŒçš„æ•°æ®é›†

- `sim`: ä»¿çœŸæ•°æ®é›†ï¼ˆç”¨äºæµ‹è¯•ï¼‰
- `hp`: HPæ•°æ®é›†ï¼ˆCMAPå›¾åƒæ•°æ®ï¼‰

## æ”¯æŒçš„æŸå¤±å‡½æ•°

- `cross_entropy`: äº¤å‰ç†µæŸå¤±
- `focal`: Focal Loss
- `mse`: å‡æ–¹è¯¯å·®æŸå¤±
- `combined`: ç»„åˆæŸå¤±ï¼ˆMUæ•°é‡MSE + é˜ˆå€¼äº¤å‰ç†µï¼‰

## å‘½ä»¤è¡Œå‚æ•°

```bash
python train_hp.py --help
```

ä¸»è¦å‚æ•°ï¼š
- `--data_root`: æ•°æ®æ ¹ç›®å½•
- `--model`: æ¨¡å‹åç§°
- `--epochs`: è®­ç»ƒè½®æ•°
- `--batch_size`: æ‰¹æ¬¡å¤§å°
- `--lr`: å­¦ä¹ ç‡
- `--device`: è®¾å¤‡é€‰æ‹©
- `--resume`: æ¢å¤è®­ç»ƒçš„æ£€æŸ¥ç‚¹
- `--eval_only`: ä»…è¯„ä¼°æ¨¡å¼
- `--test_real_data`: åœ¨çœŸå®æ•°æ®ä¸Šæµ‹è¯•

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æ¨¡å‹

1. ç»§æ‰¿ `BaseModel` ç±»
2. å®ç° `_build_model` å’Œ `forward` æ–¹æ³•
3. æ”¯æŒå¤šè¾“å‡ºï¼ˆMUæ•°é‡ + é˜ˆå€¼ï¼‰
4. åœ¨ `create_model` å‡½æ•°ä¸­æ³¨å†Œ

### æ·»åŠ æ–°æ•°æ®é›†

1. ç»§æ‰¿ `BaseDataset` ç±»
2. å®ç° `_load_data` æ–¹æ³•
3. å¤„ç†CMAPå›¾åƒå’Œæ ‡ç­¾
4. åœ¨ `create_dataset` å‡½æ•°ä¸­æ³¨å†Œ

### è‡ªå®šä¹‰æŸå¤±å‡½æ•°

1. ç»§æ‰¿ `BaseLoss` ç±»
2. å®ç° `forward` æ–¹æ³•
3. æ”¯æŒå¤šä»»åŠ¡æŸå¤±è®¡ç®—
4. åœ¨ `create_loss` å‡½æ•°ä¸­æ³¨å†Œ

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼
